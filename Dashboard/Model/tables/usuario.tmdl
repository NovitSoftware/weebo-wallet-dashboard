table usuario

	column idusuario
		dataType: int64
		isNullable: false
		formatString: 0
		sourceProviderType: int
		summarizeBy: none
		sourceColumn: idusuario

		annotation SummarizationSetBy = Automatic

	column codigo
		dataType: string
		sourceProviderType: nvarchar(10)
		summarizeBy: none
		sourceColumn: codigo

		annotation SummarizationSetBy = Automatic

	column tokenpush
		dataType: string
		sourceProviderType: nvarchar(300)
		summarizeBy: none
		sourceColumn: tokenpush

		annotation SummarizationSetBy = Automatic

	column nombre
		dataType: string
		sourceProviderType: nvarchar(100)
		summarizeBy: none
		sourceColumn: nombre

		annotation SummarizationSetBy = Automatic

	column apellido
		dataType: string
		sourceProviderType: nvarchar(100)
		summarizeBy: none
		sourceColumn: apellido

		annotation SummarizationSetBy = Automatic

	column fecnac
		dataType: dateTime
		formatString: Long Date
		sourceProviderType: date
		summarizeBy: none
		sourceColumn: fecnac

		variation Variation
			isDefault
			relationship: 44e10f56-6e47-4180-ada9-1b39c11fa510
			defaultHierarchy: LocalDateTable_c6c0a4ce-bb3b-412f-a178-e3e814d6a61a.'Date Hierarchy'

		annotation SummarizationSetBy = Automatic

		annotation UnderlyingDateTimeDataType = Date

	column genero
		dataType: string
		sourceProviderType: nvarchar(10)
		summarizeBy: none
		sourceColumn: genero

		annotation SummarizationSetBy = Automatic

	column tdoc
		dataType: string
		sourceProviderType: nvarchar(20)
		summarizeBy: none
		sourceColumn: tdoc

		annotation SummarizationSetBy = Automatic

	column dni
		dataType: string
		sourceProviderType: nvarchar(20)
		summarizeBy: none
		sourceColumn: dni

		annotation SummarizationSetBy = Automatic

	column foto
		dataType: string
		sourceProviderType: nvarchar(50)
		summarizeBy: none
		sourceColumn: foto

		annotation SummarizationSetBy = Automatic

	column email
		dataType: string
		sourceProviderType: nvarchar(50)
		summarizeBy: none
		sourceColumn: email

		annotation SummarizationSetBy = Automatic

	column password
		dataType: string
		sourceProviderType: nvarchar(20)
		summarizeBy: none
		sourceColumn: password

		annotation SummarizationSetBy = Automatic

	column telefono
		dataType: string
		sourceProviderType: nvarchar(20)
		summarizeBy: none
		sourceColumn: telefono

		annotation SummarizationSetBy = Automatic

	column region
		dataType: string
		sourceProviderType: nvarchar(100)
		summarizeBy: none
		sourceColumn: region

		annotation SummarizationSetBy = Automatic

	column provincia
		dataType: string
		sourceProviderType: nvarchar(100)
		summarizeBy: none
		sourceColumn: provincia

		annotation SummarizationSetBy = Automatic

	column distrito
		dataType: string
		sourceProviderType: nvarchar(100)
		summarizeBy: none
		sourceColumn: distrito

		annotation SummarizationSetBy = Automatic

	column fecreg
		dataType: dateTime
		formatString: Long Date
		sourceProviderType: date
		summarizeBy: none
		sourceColumn: fecreg

		variation Variation
			isDefault
			relationship: 0eba0e9b-e3fe-445a-ba21-bac51469bd20
			defaultHierarchy: LocalDateTable_c111922e-03fa-4a9d-86c5-64f09f36203a.'Date Hierarchy'

		annotation SummarizationSetBy = Automatic

		annotation UnderlyingDateTimeDataType = Date

	column fecdes
		dataType: dateTime
		formatString: Long Date
		sourceProviderType: date
		summarizeBy: none
		sourceColumn: fecdes

		variation Variation
			isDefault
			relationship: 77f1f410-776c-41f6-9237-65c52c1a3493
			defaultHierarchy: LocalDateTable_891825be-d977-4fbb-aa54-aaffce97bba6.'Date Hierarchy'

		annotation SummarizationSetBy = Automatic

		annotation UnderlyingDateTimeDataType = Date

	column activo
		dataType: string
		sourceProviderType: nvarchar(2)
		summarizeBy: none
		sourceColumn: activo

		annotation SummarizationSetBy = Automatic

	column completo
		dataType: string
		sourceProviderType: nvarchar(1)
		summarizeBy: none
		sourceColumn: completo

		annotation SummarizationSetBy = Automatic

	column billetera
		dataType: string
		sourceProviderType: nvarchar(100)
		summarizeBy: none
		sourceColumn: billetera

		annotation SummarizationSetBy = Automatic

	column fecnuevo
		dataType: dateTime
		formatString: Long Date
		sourceProviderType: date
		summarizeBy: none
		sourceColumn: fecnuevo

		variation Variation
			isDefault
			relationship: cde5d8cc-d783-4428-8c5e-8e8523eb2080
			defaultHierarchy: LocalDateTable_f5deaa01-6cfe-458c-b390-0874c1bde1fe.'Date Hierarchy'

		annotation SummarizationSetBy = Automatic

		annotation UnderlyingDateTimeDataType = Date

	column RangoEdad = ```
			
			VAR FechaNacimiento = usuario[fecnac]
			VAR Edad = 
			    IF(
			        NOT(ISBLANK(FechaNacimiento)),
			        DATEDIFF(FechaNacimiento, TODAY(), YEAR) - 
			        IF(
			            MONTH(FechaNacimiento) > MONTH(TODAY()) || 
			            (MONTH(FechaNacimiento) = MONTH(TODAY()) && DAY(FechaNacimiento) > DAY(TODAY())), 
			            1, 
			            0
			        ),
			        BLANK()  -- Si la fecha de nacimiento es vacía, devuelve BLANK
			    )
			RETURN 
			    IF(
			        ISBLANK(Edad), 
			        "Desconocido",  -- Si la edad es BLANK, muestra "Desconocido"
			        SWITCH(
			            TRUE(),
			            Edad <= 18, "0-18",
			            Edad <= 25, "19-25",
			            Edad <= 30, "26-30",
			            Edad <= 35, "31-35",
			            Edad <= 40, "36-40",
			            Edad <= 45, "41-45",
			            Edad <= 50, "46-50",
			            Edad <= 55, "51-55",
			            Edad <= 60, "56-60",
			            "60+"  -- Para edades mayores a 60
			        )
			    )
			
			```
		summarizeBy: none

		annotation SummarizationSetBy = Automatic

	column Edad = ```
			
			VAR FechaNacimiento = usuario[fecnac]
			VAR Edad = 
			    IF(
			        NOT(ISBLANK(FechaNacimiento)),
			        DATEDIFF(FechaNacimiento, TODAY(), YEAR) - 
			        IF(
			            MONTH(FechaNacimiento) > MONTH(TODAY()) || 
			            (MONTH(FechaNacimiento) = MONTH(TODAY()) && DAY(FechaNacimiento) > DAY(TODAY())), 
			            1, 
			            0
			        ),
			        BLANK()  -- Si la fecha de nacimiento es vacía, devuelve BLANK
			    )
			    RETURN Edad
			
			```
		formatString: 0
		summarizeBy: sum

		annotation SummarizationSetBy = Automatic

	column 'Genero Filtrado' = ```
			
			IF(
			    'usuario'[genero] = "Femenino" || 'usuario'[genero] = "Masculino", 
			    'usuario'[genero], 
			    BLANK()
			)
			
			```
		summarizeBy: none

		annotation SummarizationSetBy = Automatic

	column 'Estado Usuario' = ```
			
			SWITCH(
			    'usuario'[activo],
			    "d", "Riesgo",
			    "n", "Nuevo",
			    "pd", "Perdido",
			    "s", "Activo",
			    "Desconocido"  -- Esto es por si hay valores que no coinciden con los anteriores
			)
			
			```
		summarizeBy: none

		annotation SummarizationSetBy = Automatic

	partition usuario = m
		mode: import
		source =
				let
				    Source = Sql.Databases("40.79.18.177"),
				    Apployalty = Source{[Name="Apployalty"]}[Data],
				    dbo_usuario = Apployalty{[Schema="dbo",Item="usuario"]}[Data]
				in
				    dbo_usuario

